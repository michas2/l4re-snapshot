<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>L4Re - L4 Runtime Environment: Io, the Io Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="l4re.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">L4Re - L4 Runtime Environment
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('io.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Io, the Io Server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Io server handles all platform devices and resources such as I/O memory, ports (on x86) and interrupts, and grants access to those to clients.</p>
<p>Upon startup Io discovers all platform devices using available means on the system, e.g. on x86 the PCI bus is scanned and the ACPI subsystem initialised. Available I/O resource can also be configured via configuration scripts.</p>
<p>Io uses configuration can be considered as two parts:</p><ul>
<li>the description of the real hardware</li>
<li>the description of virtual buses</li>
</ul>
<p>Both descriptions represent hierarchical (tree) structure of device nodes. Where each device has a set of resources attached to it. And a device that has child devices can be considered a bus.</p>
<h2>Hardware Description </h2>
<p>The hardware description represents the devices that are available on the particular platform including their resource descriptions, such as MMIO regions, IO-Port regions, IRQs, bus numbers etc.</p>
<p>The root of the hardware devices is formed by a system bus device (accessible in the configuration via Io.system_bus()). As mentioned before, platforms that support methods for device discovery may populate the hardware description automatically, for example from ACPI. On platforms that do not have support for such methods you have to specify the hardware description by hand. A simple example for this is <code>x86-legacy.devs</code>.</p>
<h2>Virtual Bus Description </h2>
<p>Each Io server client is provided with its own virtual bus which it can iterate to find devices. A virtual PCI bus may be a part of this virtual bus.</p>
<div class="image">
<img src="io-overview.png" alt="io-overview.png"/>
<div class="caption">
IO Service Architecture Overview</div></div>
 The Io server must be configured to create virtual buses for its clients.</p>
<p>This is done with at least one configuration file specifying static resources as well as virtual buses for clients. The configuration may be split across several configuration files passed to Io through the command line.</p>
<p>To allow clients access to a available devices, a virtual system bus needs to be created that lists the devices and their resources that should be available to that client. The names of the busses correspond to the capabilities given to Io in its launch configuration.</p>
<p>A very simple configuration for Io could look like this:</p>
<div class="fragment"><div class="line">-- vim:ft=lua</div>
<div class="line">-- Example configuration for io</div>
<div class="line"></div>
<div class="line">-- Configure two platform devices to be known to io</div>
<div class="line">Io.Dt.add_children(Io.system_bus(), function()</div>
<div class="line"></div>
<div class="line">  -- create a new hardware device called &quot;FOODEVICE&quot;</div>
<div class="line">  FOODEVICE = Io.Hw.Device(function()</div>
<div class="line">    -- set the compatibility IDs for this device</div>
<div class="line">    -- a client tries to match against these IDs and configures</div>
<div class="line">    -- itself accordingly</div>
<div class="line">    -- the list should be sorted from specific to less specific IDs</div>
<div class="line">    compatible = {&quot;dev-foo,mmio&quot;, &quot;dev-foo&quot;};</div>
<div class="line"></div>
<div class="line">    -- set the &#39;hid&#39; property of the device, the hid can also be used</div>
<div class="line">    -- as a compatible ID when matching clients</div>
<div class="line">    Property.hid  = &quot;dev-foo,Example&quot;;</div>
<div class="line"></div>
<div class="line">    -- note: names for resources are truncated to 4 letters and a client</div>
<div class="line">    -- can determine the name from the ID field of a l4vbus_resource_t</div>
<div class="line">    -- add two resources &#39;int&#39; and &#39;regs&#39; to the device</div>
<div class="line">    Resource.int  = Io.Res.irq(17);</div>
<div class="line">    Resource.regs = Io.Res.mmio(0x6f000000, 0x6f007fff);</div>
<div class="line">  end);</div>
<div class="line"></div>
<div class="line">  -- create a new hardware device called &quot;BARDEVICE&quot;</div>
<div class="line">  BARDEVICE = Io.Hw.Device(function()</div>
<div class="line">    -- set the compatibility IDs for this device</div>
<div class="line">    -- a client tries to match against these IDs and configures</div>
<div class="line">    -- itself accordingly</div>
<div class="line">    -- the list should be sorted from specific to less specific IDs</div>
<div class="line">    compatible = {&quot;dev-bar,mmio&quot;, &quot;dev-bar&quot;};</div>
<div class="line"></div>
<div class="line">    -- set the &#39;hid&#39; property of the device, the hid can also be used</div>
<div class="line">    -- as a compatible ID when matching clients</div>
<div class="line">    Property.hid  = &quot;dev-bar,Example&quot;;</div>
<div class="line"></div>
<div class="line">    -- Specify that this device is able to use direct memory access (DMA).</div>
<div class="line">    -- This is needed to allow clients to gain access to DMA addresses</div>
<div class="line">    -- used by this device to directly access memory.</div>
<div class="line">    Property.flags = Io.Hw_device_DF_dma_supported;</div>
<div class="line"></div>
<div class="line">    -- note: names for resources are truncated to 4 letters and a client</div>
<div class="line">    -- can determine the name from the ID field of a l4vbus_resource_t</div>
<div class="line">    -- add three resources &#39;intA&#39;, &#39;intB&#39;, and &#39;regs&#39; to the device</div>
<div class="line">    Resource.intA = Io.Res.irq(19);</div>
<div class="line">    Resource.intB = Io.Res.irq(20);</div>
<div class="line">    Resource.regs = Io.Res.mmio(0x6f100000, 0x6f100fff);</div>
<div class="line">  end);</div>
<div class="line">end);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">Io.add_vbusses</div>
<div class="line">{</div>
<div class="line">-- Create a virtual bus for a client and give access to FOODEVICE</div>
<div class="line">  client1 = Io.Vi.System_bus(function ()</div>
<div class="line">    dev = wrap(Io.system_bus():match(&quot;FOODEVICE&quot;));</div>
<div class="line">  end);</div>
<div class="line"></div>
<div class="line">-- Create a virtual bus for another client and give it access to BARDEVICE</div>
<div class="line">  client2 = Io.Vi.System_bus(function ()</div>
<div class="line">    dev = wrap(Io.system_bus():match(&quot;BARDEVICE&quot;));</div>
<div class="line">  end);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Each device supports a 'compatible' property. It is a list of compatibility strings. A client matches itself against one (or multiple) compatibility IDs and configures itself accordingly. All other device members are handled according to their type. If the type is a resource (Io.Res) it is added as a named resource. Note that resource names are truncated to 4 letters and are stored in the ID field of a <a class="el" href="structl4vbus__resource__t.html" title="Description of a single vbus resource. ">l4vbus_resource_t</a>. If the type is a device it is added as a child device to the current one. All other types are treated as a device property which can be used to configure a device driver. Right now, device properties are internal to Io only.</p>
<p>Assigning clients PCI devices could look like this:</p>
<div class="fragment"><div class="line">-- This is a configuration snippet for PCI device selection</div>
<div class="line"></div>
<div class="line">local hw = Io.system_bus();</div>
<div class="line"></div>
<div class="line">Io.add_vbusses</div>
<div class="line">{</div>
<div class="line">  pciclient = Io.Vi.System_bus(function ()</div>
<div class="line">    PCI = Io.Vi.PCI_bus(function ()</div>
<div class="line">      pci_mm      = wrap(hw:match(&quot;PCI/CC_04&quot;));</div>
<div class="line">      pci_net     = wrap(hw:match(&quot;PCI/CC_02&quot;));</div>
<div class="line">      pci_storage = wrap(hw:match(&quot;PCI/CC_01&quot;));</div>
<div class="line">    end)</div>
<div class="line">  end)</div>
<div class="line">}</div>
</div><!-- fragment --><p>The CC numbers are PCI class codes. You can also use <code>REV_</code>, <code>VEN_</code>, <code>DEV_</code> and <code>SUBSYS_</code> to specify revision, vendor, device and subsystem with a hex number. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="l4re_concepts.html">Programming for L4Re</a></li><li class="navelem"><a class="el" href="l4re_servers.html">L4Re Servers</a></li>
    <li class="footer">Generated on Wed Dec 30 2015 23:22:17 for L4Re - L4 Runtime Environment by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
